#!/usr/bin/env perl6
#
use Test;
use JSON::Fast;

use lib 'lib';

use Pakku::Dist;
use Pakku::Spec;

my $dist-meta = q:to/END/;
  {
  "build-depends" : [ "build0", [ "Build1", "Build2" ] ],
  "depends": {
    "runtime": {
      "requires": [
        "Sereal:auth<cpan:*>:ver(1..*)",
        "curl:from<bin>",
        [ "Archive::Compress", "Archive::Zlib" ],
        { "name": "koko", "hints": "dodo" },
        "JSON::Fast"
      ],
      "recommends": [
        "JSON::Pretty"
      ]
    },
    "build": {
      "requires": [
        "System::Info"
      ]
    },
    "test": {
      "requires": [
        "File::Temp"
      ]
    }
  }
}
END

my %expected = %(:build(${:requires($["System::Info", "build0", ["Build1", "Build2"]])}), :runtime(${:recommends($["JSON::Pretty"]), :requires($["Sereal:auth<cpan:*>:ver(1..*)", "curl:from<bin>", ["Archive::Compress", "Archive::Zlib"], "JSON::Fast"])}), :test(${:requires($["File::Temp"])}));

my $meta = from-json $dist-meta;
my %got  = Pakku::Dist.new( :$meta ).depends;

say %got.perl;

#say %got;
#is-deeply %got, %expected;

#say $dist.depends;
